<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet id="create scenario" author="wj">
		<createTable tableName="scenario" remarks="represents a year, semester, or quarter">
			<column name="id" type="int">
				<constraints primaryKey="true" nullable="false" primaryKeyName="pk_semester"/>
			</column>
			<column name="name" type="varchar(50)" remarks="i.e. school name 2015-1">
				<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>
	
	<changeSet id="create resource" author="wj">
		<createTable tableName="resource" remarks="resources such as rooms, teachers, classes, students, grade">
			<column name="id" type="int">
				<constraints primaryKey="true" nullable="false" primaryKeyName="pk_block"/>
			</column>
			<column name="scenario_id" type="int">
				<constraints foreignKeyName="fk_resource_scenario" references="scenario(id)"/>
			</column>
			<column name="type" type="varchar(50)" remarks="the type of the resource (i.e. class)">
				<constraints nullable="false"/>
			</column>
			<column name="name" type="varchar(50)" remarks="the name of the resource (i.e. Math 101)">
				<constraints nullable="false"/>
			</column>
			<!-- some resources may be shown on a calendar -->
			<column name="starts_at" type="date" remarks="a starting date"/>
			<column name="ends_at" type="date" remarks="an ending date"/>
			<column name="at" type="varchar(50)" remarks="a cron expression denoting one or more periods period in time (e.g. 0 8 * * MON,WED,FRI *)"/>
			<column name="duration" type="varchar(50)" remarks="an expression denoting the length of time (e.g. PT1H)"/>
		</createTable>
	</changeSet>
	
	<changeSet id="create rule" author="wj">
		<createTable tableName="rule" remarks="rules governing two resources">
			<column name="a" type="int">
				<constraints primaryKey="true" nullable="false" foreignKeyName="fk_rule_resource_a" references="resource(id)"/>
			</column>
			<column name="b" type="int">
				<constraints primaryKey="true" nullable="false" foreignKeyName="fk_rule_resource_b" references="resource(id)"/>
			</column>
			<column name="set" type="char(1)" defaultValue="N" remarks="Y if the two resources must be together, N if they must not be together">
				<constraints nullable="false"/>
			</column>
			<!-- there is an implied rule in the system that two resources of the same type can not be together -->
		</createTable>
	</changeSet>
	
	<changeSet id="create user" author="wj">
		<createTable tableName="users">
			<column name="uid" type="varchar(20)">
				<constraints primaryKey="true" nullable="false" primaryKeyName="pk_user"/>
			</column>
			<column name="credentials" type="varchar(255)"/>
		</createTable>
	</changeSet>
	
	<changeSet id="create role" author="wj">
		<createTable tableName="role">
			<column name="uid">
				<constraints nullable="false" foreignKeyName="fk_role_user" references="user(uid)"/>
			</column>
			<column name="role" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>
	
	<changeSet id="insert administrator" author="wj">
		<insert tableName="user">
			<column name="uid" value="admin"/>
			<column name="credentials" value="password"/>
		</insert>
		<insert tableName="role">
			<column name="uid" value="admin"/>
			<column name="role" value="admin"/>
		</insert>
	</changeSet>

</databaseChangeLog>